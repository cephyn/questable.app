# For AI coding agents — Questable / quest_cards

Short, practical guide so an AI agent can be immediately productive working in this repo.

Quick start
- App: Flutter multi-platform app in lib/ (entry: [lib/main.dart](../lib/main.dart)).
- Backend: Firebase Cloud Functions (Python) in functions/ (entry: [functions/main.py](../functions/main.py)).
- Analysis scripts: analysis_scripts/ (node scripts used to analyze data exports).

Architecture (big picture)
- Frontend: Flutter UI lives under [lib/], routing via `GoRouter` in [lib/main.dart] and guarded using `AuthProvider` ([lib/src/providers/auth_provider.dart](../lib/src/providers/auth_provider.dart)).
- Backend: Firebase + Cloud Functions for Python: triggers live in [functions/main.py](../functions/main.py); heavy ML/NLP lives in [functions/similarity_calculator.py](../functions/similarity_calculator.py).
- Data: Primary data in Firestore `questCards` collection; similar quests are stored in subcollection `similarQuests`.

Key patterns & conventions
- Firebase config is generated by FlutterFire: see [lib/firebase_options.dart] (web only configured here). Reconfigure with FlutterFire CLI for other platforms.
- Cloud Functions use lazy imports for heavy libs (NLTK, scikit-learn) to avoid cold-start / deploy-time issues — follow the same pattern.
- NLTK expectation: functions/nltk_data must be packaged (unzip stopwords + punkt) before deploying functions. See [functions/similarity_calculator.py](../functions/similarity_calculator.py) _setup_nltk_data_for_packaging.
- Use provider + ChangeNotifier for app state (SettingsController, AuthProvider). Keep initialization order: SettingsController and AuthProvider are provided early because GoRouter redirect logic depends on AuthProvider ([lib/main.dart](../lib/main.dart)).

Essential commands (local dev & CI)
- Install deps: `flutter pub get` (root). For functions: `python -m venv .venv && .venv\Scripts\activate && pip install -r functions/requirements.txt`.
- Run app locally (web): `flutter run -d chrome`.
- Build web for hosting: `flutter build web --no-tree-shake-icons`.
- Firebase hosting deploy: `firebase deploy --only hosting` or preview channel: `firebase hosting:channel:deploy preview_build --project quest-cards-3c47a`.
- Deploy functions: `firebase deploy --only functions` (ensure packaged nltk_data if you changed NLP code).
- Run tests: `flutter test` (Flutter unit/widget tests). Python tests live under functions/ and can be run with pytest in functions/.
- Emulators: prefer `firebase emulators:start` for local Firestore, Auth and Functions testing.

Repo-specific gotchas for agents
- Do not assume firebase_options.dart is complete for all platforms; check and re-run FlutterFire CLI when adding platform support.
- When modifying functions/ similarity or NLP code: remember to package unzipped `functions/nltk_data` and test timeouts / memory in [functions/main.py] (memory options are set on triggers).
- Many backend modules use FIRESTORE and firebase_admin — initialize_app() or lazy initialization patterns are used in functions (see [functions/main.py](../functions/main.py)); match that approach to avoid double-init errors.

Where to look for examples
- UI + routing: [lib/main.dart](../lib/main.dart) and [lib/src/app.dart](../lib/src/app.dart)
- Auth flow: [lib/src/providers/auth_provider.dart](../lib/src/providers/auth_provider.dart) and [lib/src/services/firebase_auth_service.dart](../lib/src/services/firebase_auth_service.dart)
- Cloud Functions triggers & patterns: [functions/main.py](../functions/main.py), [functions/similarity_calculator.py](../functions/similarity_calculator.py)

If something's unclear
- Ask for the exact task, point to a small example file to change, and whether you should run the app, tests, or deploy preview. Provide shell commands you'd like me to run.

Limit this file to maintain actionable, repo-specific guidance — avoid general dev best-practices.
